<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>AR.js NFT with DOM Overlay Text</title>
<script src="https://aframe.io/releases/1.2.0/aframe.min.js"></script>
<script src="https://raw.githack.com/AR-js-org/AR.js/3.3.2/aframe/build/aframe-ar-nft.js"></script>

<style>
  body { margin: 0; overflow: hidden; }
  .arjs-loader {
    height: 100%; width: 100%; position: absolute; top:0; left:0;
    background-color: rgba(0,0,0,0.8); z-index: 9999;
    display:flex; justify-content:center; align-items:center;
    color:white; font-size:1.25em; text-align:center;
  }
  .overlayText {
    position: absolute;
    top: 20px; left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.7);
    color: white;
    padding: 10px 20px;
    border-radius: 6px;
    font-size: 1.2em;
    display: none;
    z-index: 999;
  }
</style>
</head>
<body>

<div class="arjs-loader">Loading, please wait...</div>

<!-- Overlay div for messages -->
<div id="overlayText" class="overlayText"></div>

<a-scene embedded vr-mode-ui="enabled: false" renderer="logarithmicDepthBuffer: true"
         arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled: false;">

  <!-- 1 — COLOSSEUM -->
  <a-nft id="colosseumMarker" type="nft" url="/textures/italy/marker"
         smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5">
    <a-entity id="colosseumModel" visible="false" position="0 -300 -100"
              scale="30 30 30" gltf-model="models/colosseum.glb" rotation="0 90 0">
    </a-entity>
  </a-nft>

  <!-- 2 — TORII -->
  <a-nft id="toriiMarker" type="nft" url="/textures/japan/marker"
         smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5">
    <a-entity id="toriiModel" visible="false" position="20 -100 -50"
              scale="0.4 0.4 0.4" gltf-model="models/torii.glb" rotation="-90 0 0">
    </a-entity>
  </a-nft>

  <!-- 3 — GEYSER -->
  <a-nft id="geyserMarker" type="nft" url="/textures/iceland/marker"
         smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5">
    <a-entity id="geyserModel" visible="false" position="75 0 0"
              scale="0.6 0.6 0.6" gltf-model="models/geyser.glb" rotation="-90 0 0">
    </a-entity>
  </a-nft>

  <!-- 4 — FLOWERS -->
  <a-nft id="flowersMarker" type="nft" url="/textures/flowers/marker"
         smooth="true" smoothCount="10" smoothTolerance=".01" smoothThreshold="5">
    <a-entity id="flowersModel" visible="false" position="75 0 0"
              scale="0.6 0.6 0.6" gltf-model="models/flowers.glb" rotation="-90 0 0">
    </a-entity>
  </a-nft>

  <!-- Camera -->
  <a-entity camera arjs-camera></a-entity>

</a-scene>

<script>
let colosseumScanned = false;
let toriiScanned = false;

const overlay = document.getElementById("overlayText");
const loader = document.querySelector(".arjs-loader");

// Utility to show overlay for a few seconds
function showOverlay(text, duration = 4000) {
  overlay.innerHTML = text;
  overlay.style.display = "block";
  setTimeout(() => {
    overlay.style.display = "none";
  }, duration);
}

// Scene loaded → hide loader and show first message
document.querySelector("a-scene").addEventListener("loaded", () => {
  loader.style.display = "none";
  showOverlay("FOLLOW THE PATH: Soil → Small Plant → Flower");
});

// Marker events
document.querySelector("#colosseumMarker").addEventListener("markerFound", () => {
  colosseumScanned = true;
  document.querySelector("#colosseumModel").setAttribute("visible", true);
  showOverlay("Soil Scanned. Scan the small plant next.");
});

document.querySelector("#toriiMarker").addEventListener("markerFound", () => {
  if (!colosseumScanned) {
    showOverlay("Scan the soil first.");
    return;
  }
  toriiScanned = true;
  document.querySelector("#toriiModel").setAttribute("visible", true);
  showOverlay("Small Plant Scanned. Scan the flower(s) next.");
});

document.querySelector("#geyserMarker").addEventListener("markerFound", () => {
  if (!colosseumScanned || !toriiScanned) {
    showOverlay("Scan the soil and small plant first.");
    return;
  }
  document.querySelector("#geyserModel").setAttribute("visible", true);
  showOverlay("Flower unlocked! The END");
});

document.querySelector("#flowersMarker").addEventListener("markerFound", () => {
  if (!colosseumScanned || !toriiScanned) {
    showOverlay("Scan the soil and small plant first.");
    return;
  }
  document.querySelector("#flowersModel").setAttribute("visible", true);
  showOverlay("Flowers unlocked — sequence complete!");
});
</script>

</body>
</html>
